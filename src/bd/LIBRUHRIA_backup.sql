DROP DATABASE IF EXISTS LIBRERIA;
CREATE DATABASE IF NOT EXISTS LIBRERIA;
USE LIBRERIA;

DROP TABLE IF EXISTS `PRODUCTOS`;
CREATE TABLE IF NOT EXISTS `PRODUCTOS` (
`ID` INT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT
);
INSERT INTO `PRODUCTOS` (`ID`)
VALUES
(NULL),(NULL),(NULL),(NULL),(NULL),
(NULL),(NULL),(NULL),(NULL),(NULL),
(NULL),(NULL),(NULL),(NULL),(NULL),
(NULL),(NULL),(NULL),(NULL),(NULL),
(NULL),(NULL),(NULL),(NULL),(NULL),
(NULL),(NULL),(NULL),(NULL),(NULL),
(NULL),(NULL),(NULL),(NULL),(NULL);

DROP TABLE IF EXISTS `LIBROS`;
CREATE TABLE IF NOT EXISTS `LIBROS` (
  `ID` INT UNSIGNED NOT NULL,
  `NOMBRE` varchar(35) NOT NULL,
  `AUTOR` varchar(45) NOT NULL,
  `FECHA_PUBLICACION` YEAR NOT NULL,
  `EDITORIAL` varchar(20) NOT NULL,
  `GENERO` VARCHAR(30) NOT NULL,
  `PRECIO` DOUBLE NOT NULL,
  `IMAGEN` BLOB NULL,
  PRIMARY KEY  (`ID`),
  FOREIGN KEY (ID) REFERENCES PRODUCTOS(ID) -- ES UNA ESPECIALIZACION DE PRODUCTO
                    ON DELETE CASCADE
                    ON UPDATE CASCADE,
  KEY `AK_TITULO_LIBRO` (`NOMBRE`),
  KEY `FK_AUTOR_LIBRO` (`AUTOR`)
) ENGINE=InnoDB ;

INSERT INTO `LIBROS` (`ID`,`NOMBRE`, `AUTOR`, `FECHA_PUBLICACION`, `EDITORIAL`, `GENERO`,`PRECIO`) 
VALUES
(1,'FARIÑA', 'NACHO CARRETERO', 2015, 'LIBROS DEL K.O','PERIODISMO', 17.95),
(2,'LA LADRONA DE HUESOS','MANEL LOUREIRO', 2022, 'PLANETA', 'NOVELA NEGRA', 19.85),
(3,'LA ÚLTIMA MISIÓN DE GWENDY','STEPHEN KING', 2022, 'SUMA', 'NARRATIVA DE TERROR', 20.80),
(4,'ROMA SOY YO','SANTIAGO POSTEGUILLO', 2022, 'S.A. EDICIONES B', 'NARRATIVA HISTÓRICA', 22.70),
(5,'EL LIBRO NEGRO DE LAS HORAS','EVA GARCIA SAENZ', 2022, 'PLANETA', 'NOVELA NEGRA', 19.85),
(6,'LA TORRE Y LA ISLA', 'ANA ALONSO', 2006, 'ANAYA', 'NARRATIVA DE AVENTURA', 14.72),
(7,'UN MUNDO FELIZ', 'ALDOUS HUXLEY', 1932, 'DE BOLSILLO', 'NARRATIVA EXTRANJERA', 10.40),
(8,'ORGULLO Y PREJUICIO', 'JANE AUSTEN', 2000, 'ALBA', 'NARRATIVA EXTRANJERA', 26.60),
(9,'EL EXTRANJERO', 'ALBERT CAMUS', 1942, 'ALIANZA', 'NARRATIVA EXTRANJERA', 12.30),
(10,'1984', 'GEORGE ORWELL', 1949, 'DEBOLSILLO', 'NARRATIVA EXTRANJERA', 8.50),
(11,'LA LADRONA DE LIBROS', 'MARKUS ZUSAK', 2007, 'LUMEN', 'NARRATIVA EXTRANJERA', 20.80),
(12,'FAHRENHEIT 451', 'RAY BRADBURY', 1953, 'RESERVOIR BOOKS', 'CIENCIA FICCIÓN', 20.80),
(13,'EL PRINCIPITO', 'ANTOINE DE SAINT-EXUPERY', 1943, 'SALAMANDRA', 'INFANTIL Y JUVENTIL', 11.40),
(14,'MARINA', 'CARLOS RUIZ ZAFÓN', 1999, 'PLANETA', 'NARRATIVA ESPAÑOLA', 8.50),
(15,'ENSAYO SOBRE LA CEGUERA', 'JOSÉ SARAMAGO', 1995, 'DEBOLSILLO', 'NARRATIVA EXTRANJERA', 12.30);

DROP TABLE IF EXISTS `MATERIAL_OFICINA`;
CREATE TABLE IF NOT EXISTS `MATERIAL_OFICINA` (
    `ID` INT UNSIGNED NOT NULL,
	`NOMBRE` varchar(30) NOT NULL,
    `PRECIO` DOUBLE NOT NULL,
	`MARCA` VARCHAR(15) NULL,
    `IMAGEN` BLOB NULL,
    PRIMARY KEY (`ID`),
    FOREIGN KEY (ID) REFERENCES PRODUCTOS(ID)
                    ON DELETE CASCADE
                    ON UPDATE CASCADE,
    KEY `AK_MARCA` (`MARCA`)

) ENGINE=InnoDB;

INSERT INTO `MATERIAL_OFICINA` (`ID`,`NOMBRE`,`PRECIO`,`MARCA`)
VALUES
(16,'BOLÍGRAFO G2',1.82,'PILOT'),
(17,'AGENDA 2022',20.49,'MR.WONDERFUL'),
(18,'ARCHIVADOR',2.15, 'ESSELTE'),
(19,'CARPETA',1.62, 'MARIOLA'),
(20,'LÁPIZ DE GRAFITO',0.44,'STAEDLER'),
(21,'GOMA DE BORRAR', 0.50, 'MILAN'),
(22,'REGLA', 0.69, 'MARCA BLANCA'),
(23,'CUADERNO', 3.50, 'MMARCA BLANCA'),
(24,'PORTAMINAS', 2.10, 'PILOT'),
(25,'BOLÍGRAFOS DE COLORES', 5.80, 'STABILO');

DROP TABLE IF EXISTS `OTROS`;
CREATE TABLE IF NOT EXISTS `OTROS` (
    `ID` INT UNSIGNED NOT NULL,
	`NOMBRE` varchar(30) NOT NULL,
	`PRECIO` DOUBLE NOT NULL,
	`MARCA` VARCHAR(15) NULL,
    `IMAGEN` BLOB NULL,
    PRIMARY KEY (`ID`),
    FOREIGN KEY (ID) REFERENCES PRODUCTOS (ID)
                    ON DELETE CASCADE
                    ON UPDATE CASCADE
) ENGINE=InnoDB;

INSERT INTO `OTROS`(`ID`,`NOMBRE`,`PRECIO`,`MARCA`)
VALUES
(26,'MONOPOLY',28.99,'HASBRO'),
(27,'ADELE -21',31.91,'UNIVERSAL'),
(28,'TRIVIAL PURSUIT', 31.99,'HASBRO'),
(29,'LIVE AT RIVER PLATE - ACDC',52.29,'UNIVERSAL'),
(30,'ABBEY ROAD - THE BEATLES',26.74,'UNIVERSAL'),
(31,'CATAN',38.25,'DEVIR'),
(32,'PANDEMIC', 31.22, 'Z-MAN GAMES'),
(33,'SCATTERGORIES', 27.35, 'HASBRO'),
(34,'HYBRID THEORY -LINKIN PARK', 25.55, 'WARNER RECORDS'),
(35,'ALADDIN SANE -DAVID BOWIE', 46.00, 'WARNER RECORDS');

CREATE VIEW OTROS_MENOS_DE_30
		AS 
        SELECT NOMBRE, 
			   PRECIO,
               MARCA
			FROM OTROS
            WHERE PRECIO < 30;

CREATE VIEW MATERIAL_ESCRITURA
		AS
        SELECT NOMBRE,
			   PRECIO,
               MARCA
			FROM MATERIAL_OFICINA
            WHERE MARCA = 'PILOT'
				OR MARCA = 'STAEDLER'
                OR MARCA = 'STABILO'; -- marca in(...)

CREATE VIEW LIBROS_EXTRANJEROS
		AS
        SELECT ID AS CLAVE_LIBRO,
			   NOMBRE ,
               AUTOR,
               FECHA_PUBLICACION AS ANYO_PUBLICACION,
               EDITORIAL,
               GENERO,
               PRECIO
			FROM LIBROS
            WHERE GENERO = 'NARRATIVA EXTRANJERA';
